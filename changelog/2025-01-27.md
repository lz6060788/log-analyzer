# 2025-01-27 更新日志

## Monaco编辑器语法高亮修复

### 问题描述
Monaco编辑器的语法高亮配置无效，日志内容没有正确的颜色高亮显示。

### 修复内容

#### 1. 语言和主题标识符匹配问题
- **问题**: LogPasteView中使用了错误的语言和主题标识符
- **修复**: 
  - 将`language="log"`改为`language="client-log"`
  - 将`theme="log-theme"`改为`theme="client-log-theme"`

#### 2. 日志级别token匹配规则优化
- **问题**: tokenizer中的日志级别匹配规则只产生`logLevel`token，但主题配置中定义了具体的`logLevel.error`等token
- **修复**: 将日志级别匹配规则分别匹配不同的级别
  ```typescript
  // 修复前
  [/\b(error|warn|info|debug|trace)\b/, 'logLevel'],
  
  // 修复后
  [/\berror\b/, 'logLevel.error'],
  [/\bwarn\b/, 'logLevel.warn'],
  [/\binfo\b/, 'logLevel.info'],
  [/\bdebug\b/, 'logLevel.debug'],
  [/\btrace\b/, 'logLevel.trace'],
  ```

#### 3. 时间戳匹配规则优化
- **修复**: 支持更多时间戳格式，包括`-`和`/`分隔符
  ```typescript
  // 修复前
  [/\d{4}\d{2}\d{2}\s+\d{2}:\d{2}:\d{2}(?:\.\d{3})?/, 'timestamp'],
  
  // 修复后
  [/\d{4}[-/]\d{2}[-/]\d{2}\s+\d{2}:\d{2}:\d{2}(?:\.\d{3})?/, 'timestamp'],
  ```

### 修改的文件
- `frontend/src/views/LogPasteView.vue`: 修正MonacoEditor的语言和主题配置
- `frontend/src/utils/clientLogLanguage.ts`: 优化tokenizer匹配规则

### 技术说明
Monaco编辑器的语法高亮需要三个要素正确配合：
1. **语言注册**: 通过`monaco.languages.register()`注册语言
2. **Token提供者**: 通过`monaco.languages.setMonarchTokensProvider()`设置tokenizer
3. **主题配置**: 通过`monaco.editor.defineTheme()`定义主题颜色

只有当这三个要素的标识符完全匹配时，语法高亮才能正常工作。 